# Changelog

Este archivo documenta los cambios realizados en el proyecto **Pastelix Ecommerce**.

El formato sigue el esquema de versionado sem√°ntico: MAJOR.MINOR.PATCH

- MAJOR: cambios incompatibles o que rompen funcionalidades existentes
- MINOR: nuevas funcionalidades compatibles
- PATCH: correcciones o mejoras internas sin cambios visibles importantes

## [0.7.0] - 2025-08-19 
### ‚ûï Agregado
- Creado el controlador `APIDatosUsuario.php` para gestionar las apis referentes al funcionamiento de la ruta `usuario` y derivados
- Creado el archivo `usuarioPedidos.js` para dar funcionalidad a la ruta `usuario/pedidos`  
- A√±adida funcionalidad a la ruta `admin/pedidos`
- Creadas las rutas:
    - `admin/pedidos/pedido`
    - `admin/ventas`
    - `admin/usuarios`
- Creadas nuevas funciones dentro del controllador `AdminController`:
    - `detallesPedido`
    - `usuarios`
    - `ventas` 

### üîß Cambiado
- Reemplazados las variables `codigosPais` y `nombresPais` del modelo `Direccion` por la variable `paisesAceptados`
- Actualizadas las funciones `validarFormulario` y `validarFormularioCheckout` del modelo `Direccion` para mantener coherencia con su nueva estructura 
- A√±adida funcion `getPaisesAceptados` en el modelo `Direccion` 
- Actualizada funci√≥n `recuperarCarrito` del controlador `APICarrito` para crear un carrito nuevo en caso de que el usuario no tenga uno asignado
- Se quito la opcion `Pay Later` del boton de Paypal
- Agregada funcion `actualizarCarritoDB` al controlador `APICarrito`
- Agregadas varias funciones al modelo `ActiveRecord`:
    - `guardarVarios`
    - `allPaginated`
    - `countByDate`
    - `thisByDate`
    - `this` 
- Cambios en la ruta `/usuario` para a√±adir la columna `telefono` al mostrar y editar los datos del usuario
- Cambiada ruta `admin/resumen` a `admin/dashboard`
- Cambiado nombre del archivo `resumen.php` a `dashboard.php`
- Cambiado nombre de la funcion `resumen` dentro del controlador `AdminController` a `dashboard`
- Agregadas varias funciones al modelo `Producto`:
    - `paginacionVentas`
    - `paginacionVentasAll`
    - `masVendido`
    - `masVendidoAll`
- Se agreg√≥ un √≠ndice √∫nico (`email_UNIQUE`) sobre la columna `email` de la tabla `usuarios`.
- Agregadas varias columnas a la tabla `usuarios`:
    - `fecha_creacion`
    - `baneo`
- Actualizado modelo `usuario` para mantener coherencia con su nueva estructura 
- Se modific√≥ el archivo `database.sql` para mantener coherencia con la nueva estructura

### üßπ Eliminado
- Eliminada funcion `guardarVarios` del modelo `PedidoProducto`

### üêõ Corregido
- Arreglados varios errores de la ruta `usuario/direcciones` y sus derivados
- Arreglado un error en la creacion de la tabla `pedidos` en el archivo `database.sql`

### üìÖ Pendiente
- Verificacion de baneo del usuario al loguear
- Mejoras menores en varias rutas
- Mejoras del dise√±o visual

## [0.6.0] - 2025-07-21 
### ‚ûï Agregado
- Creada las tablas:
    - `pedidos`
    - `pedido_productos`
    - `pedido_direccion`
    - `pedido_cliente`
- Implementado los modelos:
    - `Pedido`
    - `PedidoCliente`
    - `PedidoProducto`
    - `PedidoDireccion`
- Creado el controlador `APICheckout.php` para gestionar las apis referentes al funcionamiento de la ruta `checkout`
- Rutas para los llamados a la api:
    - `/api/verificarLogin`
    - `/api/recuperarDirecciones`
    - `/api/guardarNuevaDireccion`
    - `/api/recuperarDatosProductos` 
    - `/api/validarDatosFormulario` 
    - `/api/guardarDatosPedido` 
    - `/api/orders` 
    - `/api/orders/capture` 
- Creada ruta para tramitar el pago `/checkout`
- Creado archivo `checkout.js` para dar dinamismo a la ruta `/checkout` 
- Agregadas im√°genes de muestra tipo `thumb`
- Integraci√≥n de `paypal-server-sdk` para el manejo de los pagos
- Creado el controlador `PaypalController.php` para gestionar la integraci√≥n de paypal
- Integrado el sdk de paypal para gestionar los pagos
- A√±adida funcion `count` en el modelo `ActiveRecord`

### üîß Cambiado
- Modificados los archivos `direcciones.php` y `formularioDireccion.php` para mantener coherencia con la nueva estructura del modelo `Direccion`
- A√±adida funcion `validarFormularioCheckout` en el modelo `Direccion`
- A√±adida la columna `telefono` en la tabla `usuario`
- Modificado el modelo `Usuario` para mantener coherencia con la nueva estructura
- A√±adida funcion  `validarFormularioCheckout` en el modelo `Usuario`
- Modificado el archivo `.env` y `.env.example` para agregar las credenciales de paypal `PAYPAL_CLIENT_ID` y `PAYPAL_CLIENT_SECRET`
- A√±adida las columnas `pais_codigo` y `pais_nombre` en la tabla `direcciones`
- Modificado el modelo `Direccion` para mantener coherencia con la nueva estructura
- A√±adida las columnas `pais_codigo` y `pais_nombre` en la tabla `pedido_direccion`
- Modificado el modelo `PedidoDireccion` para mantener coherencia con la nueva estructura
- Modificado el archivo `database.sql` para mantener coherencia con la nueva estructura

### üßπ Eliminado
- Eliminadas las columnas `nombre`, `apellido`, `telefono` y `pais` de la tabla `direcciones`
- Eliminada la columna `pais` de la tabla `pedido_direccion`

### üìÖ Pendiente
- Arreglar las funciones de guardar/editar direcciones del usuario para mantener coherencia con la nueva estructura de la tabla `direcciones`
- Arreglar el mensaje de pago completado en la ruta `checkout`

## [0.5.0] - 2025-06-12 
### ‚ûï Agregado
- Creada las tablas:
    - `carritos`
    - `carrito_productos`
- Implementado los modelos:
    - `Carrito`
    - `CarritoProducto`
- Creado el controlador `APICarrito.php` para gestionar las apis referentes al funcionamiento de la tienda y su carrito
- Rutas para los llamados a la api:
    - `/api/recuperarCatalogo`
    - `/api/recuperarCarrito`
    - `/api/recuperarPrecio`
    - `/api/a√±adirProducto` 
    - `/api/actualizarCantidadProductoDelCarrito` 
    - `/api/eliminarProductoDelCarrito` 

### üîß Cambiado
- Refactorizado el archivo `tienda.js` para integrar llamado a la api en su funcionamiento
- Refactorizado el archivo `tienda.php` para pasar el renderizado de la pagina a `tienda.js`
- A√±adida funcion `whereArray` en el modelo `ActiveRecord`

### üêõ Corregido
- Arreglada la funcionalidad de la ruta `/tienda`

### üìÖ Pendiente
- Implementar procesamiento del pedido y pago
- Implementar funcionalidad en las siguientes rutas:
    - `checkout`
    - `admin`
    - `admin/resumen`
    - `admin/pedidos`
    - `usuario/pedidos`

## [0.4.0] - 2025-05-11 
### ‚ûï Agregado
- Funcionalidad para mantener las alertas persistentes tras redirecciones
- Rutas iniciales para el panel de administraci√≥n:
    - `admin`
    - `admin/productos`
    - `admin/productos/crear`
    - `admin/productos/editar`
    - `admin/resumen`
    - `admin/pedidos`
- Creaci√≥n del controlador `AdminController.php` para gestionar las rutas administrativas
- Integraci√≥n de la librer√≠a `Intervention Image` para la conversi√≥n de im√°genes al formato WebP
- Funci√≥n para redimensionar y convertir im√°genes subidas por el usuario a WebP
- Funci√≥n para eliminar las im√°genes asociadas a un producto cuando este es eliminado o se reemplaza su imagen

### üîß Cambiado
- A√±adido par√°metro `layout` en el m√©todo `render` de `Router.php` para utilizar una plantilla diferente en las rutas de administraci√≥n
- Nuevas validaciones en el modelo `Producto`
- Actualizaci√≥n de los datos de imagen en la columna `imagen` de la tabla `productos` para unificarlos con el formato de las im√°genes subidas por el usuario
- Modificado el valor de `imagen` dentro de la tabla `productos` en `database.sql` para reflejar el nuevo formato.
- Im√°genes de muestra convertidas a formato WebP

### üßπ Eliminado
- Eliminada columna `miniatura` de la tabla `productos`
- Eliminada columna `miniatura` del modelo `Producto`
- Eliminada la columna `miniatura` en la tabla `productos` del archivo `database.sql` para mantener coherencia con la nueva estructura

### üêõ Corregido
- Solucionado un error que duplicaba las solicitudes de actualizaci√≥n de datos en la ruta `/usuario`
- A√±adidas validaciones de acceso faltantes en rutas:
    - `olvide`
    - `recuperar`
    - `mensaje`
- Actualizaci√≥n del valor de `password` en la tabla `usuarios` de `database.sql` por un hash
- Correcci√≥n del llamado a im√°genes en la ruta `/tienda` para ajustarse al nuevo formato de nombres y extensiones.

### üìÖ Pendiente
- Implementar funcionalidad en las siguientes rutas:
    - `admin`
    - `admin/resumen`
    - `admin/pedidos`
    - `usuario/pedidos`

## [0.3.0] - 2025-05-05 
### ‚ûï Agregado
- Creada la tabla `direcciones` en la base de datos con sus respectivas relaciones.
- Implementado el modelo `Direccion` para interactuar con la base de datos.
- A√±adidas las rutas de creaci√≥n y edici√≥n de direcciones:
    - `usuario/direcciones/crear`
    - `usuario/direcciones/editar`
- A√±adida la funci√≥n para borrar direcciones guardadas por los usuarios.

### üìÖ Pendiente
- Agregar funcionalidad para que las alertas persistan despu√©s de una redirecci√≥n.

## [0.2.0] - 2025-05-02
### üîß Cambiado
- Migrada la l√≥gica de confirmaci√≥n de cuenta a la ruta `/actualizar`.
- Refactorizada la clase `Email` para facilitar mantenimiento y escalado futuro.

### üßπ Eliminado
- Eliminada la columna `token` del modelo `Usuario`.
- Eliminada la columna `confirmado` del modelo `Token`.

### üêõ Corregido
- Ajustadas funciones afectadas por los cambios en los modelos.


## [0.1.0] - 2025-05-01
### Inicial
- Tienda online de venta de postres
- Sistema de usuarios con registro, login y confirmaci√≥n por correo
- Carrito de compras con interfaz funcional (sin procesamiento de pedidos a√∫n)
- Validaciones de formularios (servidor y cliente)
- Separaci√≥n por roles: cliente y administrador
- Estilos con Sass y JavaScript modular usando Webpack
- Automatizaci√≥n de tareas con Gulp